<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">

<head>
    <title>Thymeleaf + htmx Todo</title>
    <script src="https://unpkg.com/htmx.org@1.9.10"></script>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css">
</head>

<body class="container mt-5">
    <h1>Todo List</h1>

    <div class="mb-3">
        <form hx-post="/todos" hx-target="#todo-list" hx-swap="innerHTML" class="d-flex">
            <input type="text" name="description" class="form-control me-2" placeholder="Add a new todo" required>
            <button type="submit" class="btn btn-primary">Add</button>
        </form>
    </div>

    <ul id="todo-list" class="list-group" th:fragment="todoList">
        <li class="list-group-item d-flex justify-content-between align-items-center" th:each="todo : ${todos}">
            <span th:text="${todo.description}" th:style="${todo.completed} ? 'text-decoration: line-through' : ''">
            </span>
            <div>
                <button class="btn btn-sm" th:classappend="${todo.completed} ? 'btn-secondary' : 'btn-success'"
                    th:text="${todo.completed} ? 'Undo' : 'Done'" th:hx-put="@{/todos/{id}/toggle(id=${todo.id})}"
                    hx-target="#todo-list" hx-swap="innerHTML">
                </button>
                <button class="btn btn-danger btn-sm" th:hx-delete="@{/todos/{id}(id=${todo.id})}"
                    hx-target="#todo-list" hx-swap="innerHTML">
                    X
                </button>
            </div>
        </li>
    </ul>

    <script>
        document.body.addEventListener('htmx:afterSwap', function (evt) {
            const form = document.querySelector('form');
            if (form) form.reset();
        });
    </script>
</body>

</html>